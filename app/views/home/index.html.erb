<% content_for :title, "ãƒ›ãƒ¼ãƒ " %>

<div class="position-relative py-0" style="background-image: url(<%= asset_path('posts-bg.png') %>);background-size: cover; background-position: top center; background-repeat: no-repeat; width: 100%; min-height: 100vh; margin: 0;">
  <div class="d-flex flex-nowrap justify-content-center gap-4 overflow-auto" style="margin-top: -10px;">
    <div class="position-relative flex-shrink-0" style="width: 100%; max-width: 350px;">
    <%= link_to mypage_path, class: "text-decoration-none" do %>
      <%= image_tag "ã‚ªãƒ¬ãƒ³ã‚¸PC.png", class: "img-fluid w-100" %>
      <div class="position-absolute start-50 translate-x-middle fw-bold text-center"
           style="top: 35%; transform: translateX(-50%);
                  color: #000000; font-size: clamp(10px, 2vw, 40px); text-shadow: 1px 1px 2px black;">
        ãƒã‚¤ãƒšãƒ¼ã‚¸
      </div>
    </div>
  <% end %>

  <div class="position-relative flex-shrink-0" style="width: 100%; max-width: 350px;">
   <%= link_to new_post_path, class: "text-decoration-none" do %>
    <%= image_tag "ãƒ–ãƒ«ãƒ¼ã‚°ãƒªãƒ¼ãƒ³.png", class: "img-fluid w-100" %>
    <div class="position-absolute start-50 translate-x-middle fw-bold text-center"
         style="top: 35%; transform: translateX(-50%);
                color: #000000; font-size: clamp(10px, 2vw, 40px); text-shadow: 1px 1px 2px black;">
      æŠ•ç¨¿
    </div>
  </div>
   <% end %>

  <div class="position-relative flex-shrink-0" style="width: 100%; max-width: 350px;">
   <%= link_to bookmarks_path, class: "text-decoration-none" do %>
    <%= image_tag "é’PC.png", class: "img-fluid w-100" %>
      <div class="position-absolute start-50 translate-x-middle fw-bold text-center"
         style="top: 35%; transform: translateX(-50%);
                color: #000000; font-size: clamp(10px, 2vw, 40px); text-shadow: 1px 1px 2px black;">
       ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯
      </div>
   <% end %>
  </div>
  </div>

  <hr style="border: none; border-bottom: 8px solid #FFF600; width: 80%; margin: -0.5rem auto 0.5rem;">

  <div class="d-flex justify-content-center align-items-center gap-3 flex-wrap mt-4">
  <!-- æŠ•ç¨¿ä¸€è¦§ãƒœã‚¿ãƒ³ -->
  <%= link_to "æŠ•ç¨¿ä¸€è¦§", posts_path, class: "btn btn-dark rounded-pill px-4 py-2 fw-bold", style: "margin-right: 50px; z-index: 2" %>

  <!-- æ¤œç´¢ãƒãƒ¼ -->
  <form action="<%= search_path %>" method="get" style="max-width: 600px; flex-grow: 1;">
    <div class="input-group" style="border: 2px solid #000; border-radius: 50px; overflow: hidden; position: relative;">
      <input type="search" name="q" class="form-control border-0 px-4"
             placeholder="ã‚¿ã‚¤ãƒˆãƒ«ã¾ãŸã¯ã‚¢ã‚«ã‚¦ãƒ³ãƒˆåã‚’å…¥åŠ›" aria-label="Search"
             autocomplete="off"
             style="height: 48px; border-radius: 0;">
      <button class="btn btn-light border-0" type="submit"
              style="height: 48px; border-radius: 0;">
        <i class="bi bi-search"></i>
      </button>
    </div>

    <!-- ğŸ”¥ autocomplete ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã®ã‚¹ãƒšãƒ¼ã‚¹ -->
    <div class="autocomplete-box"></div>
  </form>
 </div>

  <div class="container-fluid" style="max-width: 1000px; margin: 0 auto;">
   <% if @posts.present? %>
    <% @posts.each do |post| %>
     <%= render "shared/search_result", post: post %>
    <% end %>
   <% else %>
     <p class="d-flex justify-content-center text-muted mt-5">
       è©²å½“ã™ã‚‹æŠ•ç¨¿ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚
     </p>
   <% end %>
  </div>
</div>

<script>
  function initAutocomplete() {
    const input = document.querySelector("input[name='q']");
    if (!input) return;

    const suggestionBox = document.createElement("div");
    suggestionBox.className = "autocomplete-box";

    const group = input.closest(".input-group");
    group.insertAdjacentElement("afterend", suggestionBox);

    input.addEventListener("input", async (e) => {
      const query = e.target.value;
      if (query.length < 1) {
        suggestionBox.innerHTML = "";
        return;
      }

      try {
        const res = await fetch(`/search/autocomplete?q=${encodeURIComponent(query)}`);
        const suggestions = await res.json();

        suggestionBox.innerHTML = "";
        suggestions.forEach(s => {
          const item = document.createElement("div");
          item.textContent = s;
          item.className = "autocomplete-item";
          item.onclick = () => {
            input.value = s;
            suggestionBox.innerHTML = "";
          };
          suggestionBox.appendChild(item);
        });
      } catch (error) {
        console.error("Autocomplete fetch failed:", error);
        suggestionBox.innerHTML = "";
      }
    });
  }

  document.addEventListener("DOMContentLoaded", initAutocomplete);
  document.addEventListener("turbo:load", initAutocomplete);
</script>


<style>
@media (max-width: 768px) {
  /* æ¨ªä¸¦ã³ã®ã‚³ãƒ³ãƒ†ãƒŠ */
  .d-flex.flex-nowrap {
    gap: 8px !important;       /* éš™é–“ã‚’å°‘ã—ç‹­ã */
    overflow-x: auto !important; /* æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ã« */
    padding: 0 8px;
  }

  /* å„ã‚«ãƒ¼ãƒ‰ */
  .position-relative.flex-shrink-0 {
    max-width: 120px !important; /* æ¨ªå¹…ã‚’ç¸®å° */
    flex: 0 0 auto !important;   /* æ¨ªä¸¦ã³ã‚’ç¶­æŒ */
  }

  /* ç”»åƒ */
  .position-relative.flex-shrink-0 img {
    width: 100% !important;
    height: auto !important;
  }

  /* ãƒ†ã‚­ã‚¹ãƒˆï¼ˆãƒã‚¤ãƒšãƒ¼ã‚¸ãƒ»æŠ•ç¨¿ãƒ»ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ï¼‰ */
  .position-relative.flex-shrink-0 div {
    font-size: 12px !important; /* æ–‡å­—ã‚µã‚¤ã‚ºç¸®å° */
    top: 30% !important;
    text-shadow: 0.5px 0.5px 1px black;
  }


  /* åŒºåˆ‡ã‚Šç·š */
  hr {
    width: 90% !important;
    border-bottom: 4px solid #FFF600 !important;
    margin: 1rem auto !important;
  }

  /* æŠ•ç¨¿ä¸€è¦§ãƒœã‚¿ãƒ³ */
  .btn.btn-dark {
    font-size: 16px !important;
    padding: 8px 16px !important;
    margin-right: 0 !important;
    width: 100% !important;
    max-width: 320px;
  }

  /* æ¤œç´¢ãƒãƒ¼ */
  form[action*="search"] {
    max-width: 100% !important;
    margin-top: 12px;
  }

  form[action*="search"] .input-group {
    border-radius: 30px !important;
  }

  form[action*="search"] input[type="search"] {
    font-size: 14px !important;
    height: 40px !important;
    padding: 6px 12px !important;
  }

  form[action*="search"] button {
    height: 40px !important;
    font-size: 14px !important;
  }

  /* æŠ•ç¨¿ä¸€è¦§ã‚³ãƒ³ãƒ†ãƒŠ */
  .container-fluid {
    max-width: 95% !important;
    padding: 0 12px;
  }

  .container-fluid p {
    font-size: 14px !important;
    text-align: center;
  }
}
</style>