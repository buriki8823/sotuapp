<div class="position-relative py-0" style="background-image: url(<%= asset_path('posts-bg.png') %>);background-size: cover; background-position: top center; background-repeat: no-repeat; width: 100%; min-height: 100vh; margin: 0;">
  <div class="d-flex flex-nowrap justify-content-center gap-4 overflow-auto" style="margin-top: -10px;">
    <div class="position-relative flex-shrink-0" style="width: 100%; max-width: 350px;">
    <%= link_to mypage_path, class: "text-decoration-none" do %>
      <%= image_tag "オレンジPC.png", class: "img-fluid w-100" %>
      <div class="position-absolute start-50 translate-x-middle fw-bold text-center"
           style="top: 35%; transform: translateX(-50%);
                  color: #000000; font-size: clamp(10px, 2vw, 40px); text-shadow: 1px 1px 2px black;">
        マイページ
      </div>
    </div>
  <% end %>

  <div class="position-relative flex-shrink-0" style="width: 100%; max-width: 350px;">
   <%= link_to new_post_path, class: "text-decoration-none" do %>
    <%= image_tag "ブルーグリーン.png", class: "img-fluid w-100" %>
    <div class="position-absolute start-50 translate-x-middle fw-bold text-center"
         style="top: 35%; transform: translateX(-50%);
                color: #000000; font-size: clamp(10px, 2vw, 40px); text-shadow: 1px 1px 2px black;">
      投稿
    </div>
  </div>
   <% end %>

  <div class="position-relative flex-shrink-0" style="width: 100%; max-width: 350px;">
   <%= link_to bookmarks_path, class: "text-decoration-none" do %>
    <%= image_tag "青PC.png", class: "img-fluid w-100" %>
      <div class="position-absolute start-50 translate-x-middle fw-bold text-center"
         style="top: 35%; transform: translateX(-50%);
                color: #000000; font-size: clamp(10px, 2vw, 40px); text-shadow: 1px 1px 2px black;">
       ブックマーク
      </div>
   <% end %>
  </div>
  </div>

  <hr style="border: none; border-bottom: 8px solid #FFF600; width: 80%; margin: -0.5rem auto 0.5rem;">

  <div class="d-flex justify-content-center align-items-center gap-3 flex-wrap mt-4">
  <!-- 投稿一覧ボタン -->
  <%= link_to "投稿一覧", posts_path, class: "btn btn-dark rounded-pill px-4 py-2 fw-bold", style: "margin-right: 50px; z-index: 2" %>

  <!-- 検索バー -->
  <form action="<%= search_path %>" method="get" style="max-width: 600px; flex-grow: 1;">
    <div class="input-group" style="border: 2px solid #000; border-radius: 50px; overflow: hidden;">
      <input type="search" name="q" class="form-control border-0 px-4"
             placeholder="タイトルまたはアカウント名を入力" aria-label="Search"
             style="height: 48px; border-radius: 0;">
      <button class="btn btn-light border-0" type="submit"
              style="height: 48px; border-radius: 0;">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </form>
 </div>

  <div class="container-fluid" style="max-width: 1000px; margin: 0 auto;">
   <% if @posts.present? %>
    <% @posts.each do |post| %>
     <%= render "shared/search_result", post: post %>
    <% end %>
   <% else %>
     <p class="d-flex justify-content-center text-muted mt-5">
       該当する投稿は見つかりませんでした。
     </p>
   <% end %>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const input = document.querySelector("input[name='q']");
    const suggestionBox = document.createElement("div");
    suggestionBox.className = "autocomplete-box";
    input.parentNode.appendChild(suggestionBox);

    input.addEventListener("input", async (e) => {
      const query = e.target.value;
      if (query.length < 2) return suggestionBox.innerHTML = "";

      const res = await fetch(`/search/autocomplete?q=${encodeURIComponent(query)}`);
      const suggestions = await res.json();

      suggestionBox.innerHTML = "";
      suggestions.forEach(s => {
        const item = document.createElement("div");
        item.textContent = s;
        item.className = "autocomplete-item";
        item.onclick = () => {
          input.value = s;
         suggestionBox.innerHTML = "";
        };
        suggestionBox.appendChild(item);
      });
    });
  });
</script>

<style>
@media (max-width: 768px) {
  /* 横並びのコンテナ */
  .d-flex.flex-nowrap {
    gap: 8px !important;       /* 隙間を少し狭く */
    overflow-x: auto !important; /* 横スクロール可能に */
    padding: 0 8px;
  }

  /* 各カード */
  .position-relative.flex-shrink-0 {
    max-width: 120px !important; /* 横幅を縮小 */
    flex: 0 0 auto !important;   /* 横並びを維持 */
  }

  /* 画像 */
  .position-relative.flex-shrink-0 img {
    width: 100% !important;
    height: auto !important;
  }

  /* テキスト（マイページ・投稿・ブックマーク） */
  .position-relative.flex-shrink-0 div {
    font-size: 12px !important; /* 文字サイズ縮小 */
    top: 30% !important;
    text-shadow: 0.5px 0.5px 1px black;
  }


  /* 区切り線 */
  hr {
    width: 90% !important;
    border-bottom: 4px solid #FFF600 !important;
    margin: 1rem auto !important;
  }

  /* 投稿一覧ボタン */
  .btn.btn-dark {
    font-size: 16px !important;
    padding: 8px 16px !important;
    margin-right: 0 !important;
    width: 100% !important;
    max-width: 320px;
  }

  /* 検索バー */
  form[action*="search"] {
    max-width: 100% !important;
    margin-top: 12px;
  }

  form[action*="search"] .input-group {
    border-radius: 30px !important;
  }

  form[action*="search"] input[type="search"] {
    font-size: 14px !important;
    height: 40px !important;
    padding: 6px 12px !important;
  }

  form[action*="search"] button {
    height: 40px !important;
    font-size: 14px !important;
  }

  /* 投稿一覧コンテナ */
  .container-fluid {
    max-width: 95% !important;
    padding: 0 12px;
  }

  .container-fluid p {
    font-size: 14px !important;
    text-align: center;
  }
}
</style>