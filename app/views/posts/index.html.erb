<% content_for :title, "投稿一覧" %>

<div class="position-relative py-0" style="background-image: url(<%= asset_path('posts-bg.png') %>);background-size: cover; background-position: top center; background-repeat: no-repeat; width: 100%; min-height: 100vh; margin: 0;">
  <div class="container py-4">
    <h1 class="toukou-title text-center mt-3 mb-5" style="position: relative; top: 30px; font-size: 100px;">投稿一覧</h1>

    <!-- カード群とソートボタンのラッパー -->
    <div style="max-width: 1500px; margin: 0 auto;">
      
      <!-- ソートボタン：左寄せ -->
      <div class="mb-4 d-flex justify-content-start">
        <div class="dropdown">
          <button class="btn btn-outline-dark dropdown-toggle" type="button" id="sortDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            ソート
          </button>
          <ul class="dropdown-menu" aria-labelledby="sortDropdown">
            <li><%= link_to "新着順", posts_path, class: "dropdown-item" %></li>
            <li><%= link_to "かわいい順", posts_path(sort: "cute"), class: "dropdown-item" %></li>
            <li><%= link_to "かっこいい順", posts_path(sort: "cool"), class: "dropdown-item" %></li>
            <li><%= link_to "スタイリッシュ順", posts_path(sort: "stylish"), class: "dropdown-item" %></li>
            <li><%= link_to "癒し順", posts_path(sort: "healing"), class: "dropdown-item" %></li>
            <li><%= link_to "美的順", posts_path(sort: "aesthetic"), class: "dropdown-item" %></li>
            <li><%= link_to "人気順", posts_path(sort: "popular"), class: "dropdown-item" %></li>
          </ul>
        </div>
      </div>

      <!-- 投稿カード群 -->
      <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
        <% @posts.each do |post| %>
          <div class="col">
            <div class="card h-100 shadow-sm">
              <%= link_to post_path(post), class: "d-block" do %>
                <%= image_tag post.first_image_url_or_placeholder.sub("/upload/", "/upload/c_fill,g_auto,w_600,h_230/"), alt: "投稿画像", style: "width: calc(100% - 24px); height: 230px; object-fit: cover; margin: 12px; border: 1px solid #ccc; border-radius: 6px;" %>
              <% end %>
              <div class="card-body">
                <h5 class="card-title"><%= post.title %></h5>
                <div class="card-text text-muted" style="font-size: 20px;">
                   投稿者：<%= post.user.name %>
                </div>

                <% if post.rating_enabled? %>
                  <div class="d-flex align-items-center flex-wrap mt-1">
                    <% avg_score = post.average_star_score.to_f.round %>
                    <% (1..5).each do |i| %>
                      <% if i <= avg_score %>
                        <span class="star-icon text-warning"><i class="bi bi-star-fill"></i></span>
                      <% else %>
                        <span class="star-icon text-secondary"><i class="bi bi-star"></i></span>
                      <% end %>
                    <% end %>
                  </div>
                <% end %>
              </div>
            </div>
          </div>
        <% end %>

        <% @dummy_count.times do %>
          <div class="col">
            <div class="card h-100 shadow-sm">
              <%= image_tag "placeholder.png", class: "card-img-top", alt: "ダミー画像", style: "height: 250px; object-fit: cover;" %>
              <div class="card-body text-center text-muted">
                <h5 class="card-title">投稿募集中</h5>
              </div>
            </div>
          </div>
        <% end %>
      </div>

      <!-- ページネーション -->
      <div class="d-flex justify-content-center mt-5">
        <%= paginate @posts %>
      </div>
    </div>
  </div>
</div>

<style>
@media (max-width: 768px) {
  .toukou-title {
    font-size: 50px !important;
    margin-top: 20px !important;
    margin-bottom: 30px !important;
  }
}
</style>