<div class="position-relative py-0" style="background-image: url(<%= asset_path('posts-bg.png') %>); background-size: cover; background-position: top center; background-repeat: no-repeat; width: 100%; min-height: 100vh; margin: 0;">

  <div style="position: absolute; left: 10; right: 0; z-index: 10;">
    <%= render "shared/navigation_box" %>
  </div>

  <h1 class="toukou-title text-center mb-5" style="position: relative; top: 70px; font-size: 128px;"><%= @post.title %></h1>  

  <% if @post.image_urls.present? %>
    <div class="d-flex gap-2 justify-content-center mb-5" style="max-width: 1500px; margin: 0 auto;">
    
      <!-- 左：画像 -->
      <div class="swiper mySwiper rounded shadow-sm overflow-hidden"
           style="flex: 1 1 500px; height: 600px; margin-top: 20px; margin-left:100px;">
        <div class="swiper-wrapper">
          <% @post.image_urls.each do |url| %>
            <div class="swiper-slide">
              <%= image_tag url, class: "w-100 h-100", alt: "投稿画像", style: "object-fit: cover;" %>
            </div>
          <% end %>
        </div>
        <div class="swiper-button-next"></div>
        <div class="swiper-button-prev"></div>
        <div class="swiper-pagination"></div>
      </div>

      <!-- Swiperのカスタムスタイル -->
      <style>
        .swiper-button-next svg,
        .swiper-button-prev svg {
          display: none;
        }

        .swiper-button-next::after {
          content: '▶'; 
          color: red; !important;
          font-size: 32px; !important;
        }

        .swiper-button-prev::after {
          content: '◀'; 
          color: red;  !important;
          font-size: 32px; !important;
          font-weight: bold; !important;
        }

        .swiper-pagination-bullet {
          background-color: red !important;
          opacity: 1;
        }

        .swiper-pagination-bullet-active {
          background-color: darkred !important;
        }
      </style>


      <!-- 右：投稿者情報ボックス -->
      <div class="p-4 rounded shadow-sm"
           style="position: relative; flex: 0 0 300px; height: 400px; background-color: #ffffff; border: 2px solid #000; overflow-y: auto; margin-top: 20px; margin-right: 24px;">

          <div class="d-flex align-items-center mb-4" style="border-bottom: 2px solid #000; padding-bottom: 10px;">
            <%= image_tag @post.user.avatar_url.presence || "default_avatar.png", alt: "投稿者アイコン", class: "rounded-circle me-3", style: "position: relative; left: 10px; width: 64px; height: 64px; object-fit: cover;" %>
            <h4 class="fw-bold mb-0" style="position: relative; left: 20px;"><%= @post.user.name %></h4>
          </div>

          <% if user_signed_in? %>
            <% if @bookmarked %>
              <%= button_to post_bookmark_path(@post), method: :delete, class: "btn mb-4 w-100", style: "background-color: #dc3545; color: white;" do %>
                <i class="bi bi-bookmark-x me-2"></i>ブックマーク解除
              <% end %>
            <% else %>
              <%= button_to post_bookmark_path(@post), method: :post, class: "btn mb-4 w-100", style: "background-color: orange; color: white;" do %>
                <i class="bi bi-bookmark-plus me-2"></i>ブックマークする
              <% end %>
            <% end %>
          <% else %>
            <button class="btn mb-4 w-100" style="background-color: gray; color: white;" disabled>
              <i class="bi bi-bookmark me-2"></i>ログインしてブックマーク
            </button>
          <% end %>

          <%= link_to "ブックマーク一覧へ", bookmarks_path, class: "btn w-100", style: "background-color: #6c757d; color: white;" %>
          <%= button_to post_path(@post),
              method: :delete,
              data: { confirm: "本当に削除しますか？" },
              params: {},
              class: "btn btn-danger",
              style: "z-index: 10; position: absolute; bottom: 8px; right: 8px;" do %>
            投稿を削除
          <% end %>
      </div>

    </div>
  <% else %>
    <p class="text-center text-muted">画像は投稿されていません</p>
  <% end %>

  <!-- お部屋説明 -->
  <div style="max-width: 1500px; margin: 0 auto;">
    <h3 class="fw-bold mb-3" style="text-align: left;">お部屋説明</h3>

    <div class="rounded-4 shadow-sm p-5 mb-5"
         style="background-color: #ffffff; border: 2px solid #000; min-height: 200px;">
      <div style="font-size: 25px; line-height: 1.6;"><%= simple_format(@post.body) %></div>
    </div>
  </div>


  <!-- オススメグッズ -->
  <% visible_products = @post.products.select do |product| %>
    <% [product.title, product.description, product.image_url].any?(&:present?) %>
  <% end %>
  <% if visible_products.any? %>
    <!-- 左上に見出し -->
    <div style="max-width: 1500px; margin: 0 auto;">
      <h2 class="fw-bold mb-4" style="font-size: 48px; text-align: left;">オススメグッズ</h2>

      <!-- 商品カード群 -->
      <div class="d-flex flex-column gap-5 mb-5">
        <% visible_products.each do |product| %>
          <div class="d-flex gap-4 align-items-center p-4 shadow-sm rounded mx-auto mb-0"
               style="position: relative; top: -10px; width: 1500px; height: 300px; background-color: #ffffff; border: 2px solid #000;">
            <% if product.image_url.present? %>
              <div style="width: 400px; height: 100%; flex-shrink: 0;">
                <%= image_tag product.image_url, class: "img-fluid w-100 h-100", style: "object-fit: cover;" %>
              </div>
            <% end %>
            <div class="flex-grow-1">
              <h2 class="fw-bold fs-2 mb-3" style="position: relative; left: 10px;"><%= product.title %></h2>
              <div class="p-4 rounded-3 border" style="background-color: #ffffff; border-color: #000;">
                <p class="fs-5 lh-lg mb-0"><%= simple_format(product.description) %></p>
              </div>
              <% if product.url.present? %>
                <a href="<%= product.url %>" target="_blank" class="btn btn-success mt-3">商品ページを見る</a>
              <% else %>
                <p class="text-muted mt-3">URLはありません</p>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>


  <!-- コメントセクション -->
  <div class="mx-auto " style="max-width: 1500px;">
    <h3 class="fw-bold mb-3">コメントを投稿する</h3>
    <%= form_with(model: [@post, Comment.new], local: true) do |f| %>
      <div class="mb-3">
        <%= f.text_area :body, rows: 4, class: "form-control", placeholder: "コメントを入力してください" %>
      </div>
      <%= f.submit "投稿", class: "btn btn-primary" %>
    <% end %>
  </div>

  <div class="mx-auto" style="position: relative; top: -20px; margin-top: 50px; max-width: 1500px;">
    <% if @post.comments.any? %>
      <h3>コメント一覧</h3>
      <% @post.comments.each do |comment| %>
        <div class="p-3 rounded shadow-sm" style="margin-top: 10px; background-color: #fff; border: 1px solid #ccc;">
          <p class="mb-1"><strong><%= comment.user.name %></strong></p>
         <hr style="margin-top: 5px; margin-bottom: 10px; border-top: 1px solid #999;">
          <p class="mb-0"><%= simple_format(comment.body) %></p>
        </div>
      <% end %>
    <% else %>
      <p class="text-muted mb-0">まだコメントはありません。</p>
    <% end %>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    new Swiper(".mySwiper", {
      loop: true,
      pagination: {
        el: ".swiper-pagination",
        clickable: true,
      },
      navigation: {
        nextEl: ".swiper-button-next",
        prevEl: ".swiper-button-prev",
      },
    });
  });
</script>