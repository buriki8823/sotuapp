<div class="position-relative">
  <h1 class="toukou-title text-center mt-3 mb-5" style="position: relative; top: 30px; font-size: 128px;">投稿</h1>

  <div style="position: absolute; top: 0; right: 0; z-index: 10;">
    <%= render "shared/navigation_box" %>
  </div>
</div>

<div class="position-relative">
  <%= form_with model: @post, local: true, html: { multipart: true } do |f| %>
    <!-- タイトル -->
    <div style="width: 1700px; margin: 0 auto; margin-bottom: 100px;">
      <%= f.label :title, "タイトル", style: "font-size: 64px;", class: "form-label d-block text-start mb-1" %>
      <%= f.text_field :title, class: "form-control", style: "height: 65px;" %>
    </div>

      <!-- 画像 -->
    <div class="mb-3" style="width: 1700px; margin: 0 auto;">
      <label class="form-label d-block text-start mb-1" style="font-size: 64px;">画像</label>
    </div>

    <div class="d-flex gap-5 flex-wrap justify-content-start my-4" style="width: 1700px; margin: 0 auto; padding-bottom: 100px;">
      <% 5.times do |i| %>
        <div class="image-slot rounded-3 border"
             style="width: 300px; height: 300px; background-color: #f8f9fa; cursor: pointer; display: flex; align-items: center; justify-content: center;">
          <span style="pointer-events: none; color: #aaa; font-size: 32px">画像を挿入</span>
        </div>
      <% end %>
    </div>

    <button type="button" id="cloudinary-upload-button" class="d-none"></button>



    <!-- 概要 -->
    <div style="width: 1700px; margin: 0 auto; margin-bottom: 100px;">
      <%= f.label :body, "概要", style: "font-size: 64px;" %>
      <%= f.text_area :body, class: "form-control", rows: 20, style: "height: 400px; font-size: 24px;" %>
    </div>

    <!-- オススメグッズ -->
    <div style="width: 1700px; margin: 0 auto; margin-bottom: 100px;">
      <%= label_tag :products, "オススメグッズ（紹介したいグッズがあれば挿入してください）", style: "font-size: 64px;" %>
    </div>

    <div class="d-flex gap-5 flex-wrap justify-content-start my-4" style="width: 1700px; margin: 0 auto; padding-bottom: 100px;">
      <%= f.fields_for :products do |pf| %>
        <div class="d-flex flex-column align-items-center" style="width: 300px;">
          <!-- 表示枠（クリックでモーダル） -->
          <div class="product-slot rounded-3 border position-relative"
               data-index="<%= pf.index %>"
               style="width: 300px; height: 300px; background-color: #f8f9fa; cursor: pointer; display: flex; align-items: center; justify-content: center;">
            <span style="color: #aaa; font-size: 32px;">オススメ商品を挿入</span>
          </div>

          <!-- hidden input群（form送信対象） -->
          <div class="product-fields d-none">
            <%= pf.text_field :title, id: "product-title-#{pf.index}" %>
            <%= pf.text_area :description, id: "product-description-#{pf.index}" %>
            <%= pf.text_field :url, id: "product-url-#{pf.index}" %>
            <%= pf.hidden_field :image_url, id: "product-image-url-#{pf.index}" %>
          </div>
        </div>
      <% end %>
    </div>

    <!-- モーダル本体 -->
    <div id="product-modal" class="position-fixed top-0 start-0 w-100 h-100 align-items-center justify-content-center"
         style="background-color: rgba(0,0,0,0.5); z-index: 9999; display: none;">
      <div class="rounded-4 p-5" style="width: 800px; max-height: 90vh; overflow-y: auto; background-color: #E7EEEE;">
        <h2 class="mb-4" style="font-size: 48px;">オススメの商品を追加してください</h2>

        <div class="mb-3">
          <label for="modal-title" class="form-label">タイトル</label>
          <input type="text" id="modal-title" class="form-control">
        </div>

        <div class="mb-3">
          <label for="modal-description" class="form-label">商品説明</label>
          <textarea id="modal-description" class="form-control" rows="4"></textarea>
        </div>

        <div class="mb-3">
          <label for="modal-url" class="form-label">商品ページ（リンク）</label>
          <input type="text" id="modal-url" class="form-control" placeholder="https://example.com">
        </div>

        <button type="button" id="modal-image-upload"
                class="btn"
                style="border: 2px solid #a8e063; color: #a8e063; background-color: transparent;"
                onmouseover="this.style.backgroundColor='#a8e063'; this.style.color='#fff';"
                onmouseout="this.style.backgroundColor='transparent'; this.style.color='#a8e063';">
          画像をアップロード
        </button>

        <div id="modal-image-preview" class="mt-3" style="height: 180px;"></div>

        <div class="d-flex justify-content-end mt-4">
          <button type="button" id="modal-cancel" class="btn btn-secondary me-3">キャンセル</button>
          <button type="button" id="modal-ok" class="btn btn-primary">OK</button>
        </div>
      </div>
    </div>

    <!-- 投稿ボタン -->
    <div class="text-center mt-4" style="margin-bottom: 200px;">
      <%= f.submit "投稿する",
          id: "post-submit-button",
          class: "btn",
          style: "background-color: #a8e063; color: #fff; border: none; padding: 20px 40px; font-size: 32px;",
          data: { turbo: false } %>
    </div>
  <% end %>
</div>

<% content_for :footer do %>
  <div style="display: none;"></div>
<% end %>