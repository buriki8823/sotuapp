<div class="search-result-card rounded p-3 d-flex flex-wrap" style="position: relative; top: -10px; background-color: white; margin-top: 40px; min-height: 200px; border: 2px solid black;">
  <!-- 左側：アイコン＋アカウント名 -->
  <div class="user-info d-flex flex-column align-items-center justify-content-center shadow-sm"
       style="flex: 0 0 30%; border: 2px solid #000; background-color: #fff; border-radius: 12px; padding: 30px;">
  
    <%= image_tag(post.user.avatar_url_or_default.sub('/upload/', '/upload/c_thumb,w_600,h_600,r_max/'), class: "rounded-circle mb-2", size: "200x200") %>

    <span class="fw-bold text-center" style="margin-top: 30px; font-size: 25px;">投稿者：<%= post.user.name %></span>

    <div class="star-row d-flex align-items-center">
      <% if post.rating_enabled? %>
       <div class="star-row d-flex flex-column align-items-start">
         <div class="mb-1" style="font-size: 20px;">この投稿の評価</div>
         <div class="d-flex align-items-center">
           <% avg_score = post.average_star_score.to_f.round %>
           <% (1..5).each do |i| %>
             <% if i <= avg_score %>
               <span class="star-icon text-warning"><i class="bi bi-star-fill"></i></span>
             <% else %>
              <span class="star-icon text-secondary"><i class="bi bi-star"></i></span>
             <% end %>
           <% end %> 
         </div>
        </div>   
       <% else %>
       <% end %>
      </div>
    </div>

  <!-- 右側：投稿画像 -->
  <div class="post-image" style="position: relative; left: 10px; border: 1px solid black; flex: 0 0 70%; height: 500px;">
    <%= link_to post_path(post) do %>
      <% if post.image_urls.present? && post.image_urls.first.present? %>
        <% transformed_url = post.image_urls.first.sub('/upload/', '/upload/c_fit,w_1000,h_500/') %>

        <%= image_tag transformed_url,
            class: "rounded",
            style: "width: 100%; height: 100%; object-fit: contain; background-color: silver;" %>

      <% else %>
        <%= image_tag "no_image.png",
            class: "rounded",
            style: "width: 100%; height: 100%; object-fit: contain; background-color: silver;" %>
      <% end %>
    <% end %>
  </div>
</div>

<style>
@media (max-width: 768px) {
  .search-result-card {
    flex-direction: row !important;
    flex-wrap: nowrap !important;
    align-items: center !important;
    padding: 12px !important;
    margin-top: 20px !important;
  }

  .search-result-card .user-info {
    flex: 0 0 40% !important;
    padding: 12px !important;
  }

  .search-result-card .user-info img {
    width: 80px !important;
    height: 80px !important;
  }

  .search-result-card .user-info span {
    font-size: 14px !important;
    margin-top: 8px !important;
  }

  .search-result-card .star-row div {
    font-size: 12px !important;
  }

  .search-result-card .star-icon {
    font-size: 12px !important;
  }

  .search-result-card .post-image {
    flex: 0 0 60% !important;
    height: auto !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    overflow: hidden !important;
    border: none !important;
    box-shadow: none !important;
    padding: 0 !important;
    left: 0 !important;
  }

  .search-result-card .post-image img {
    width: 100% !important;
    height: auto !important;
    max-height: 180px !important;
    object-fit: cover !important;
    display: block;
  }
}
</style>